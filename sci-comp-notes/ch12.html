<!DOCTYPE html>  
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <title>ch12</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style id="mkstylesheet">
body{-webkit-font-smoothing:antialiased;font-family:"Helvetica Neue",Helvetica,Arial,Verdana,sans-serif;margin:30px 0 0;padding:0;background:#fff}#wrapper{padding:20px}li{font-size:110%}li li{font-size:100%}li p{font-size:100%;margin:.5em 0}h1{color:#000}h2{color:#111}h3{color:#111;margin:0}h4{color:#111}h5{color:#111}h6{font-size:1em;line-height:1.5em;margin:1.5em 0}body,p,td,div{color:#111;font-family:"Helvetica Neue",Helvetica,Arial,Verdana,sans-serif;word-wrap:break-word}a{color:#0d6ea1;text-decoration:none;-webkit-transition:color .2s ease-in-out;-moz-transition:color .2s ease-in-out;-o-transition:color .2s ease-in-out;-ms-transition:color .2s ease-in-out;transition:color .2s ease-in-out}a:hover{color:#3593d9}body{font-size:15px;line-height:21px;margin:0 auto}h1{font-size:37px;line-height:42px;margin-top:42px;margin-bottom:21px}h2{font-size:27px;line-height:42px;margin-top:42px;margin-bottom:21px}h3{font-size:20px;line-height:21px;margin-top:21px;margin-bottom:21px}h4{font-size:20px;line-height:21px;margin-top:21px;margin-bottom:21px}p,ul,ol,pre,table,blockquote{margin-top:21px;margin-bottom:21px}hr{border:1px solid;margin:-1px 0}ul ul,ol ol,ul ol,ol ul{margin-top:0;margin-bottom:0}b,strong,em,small,code{line-height:1}.footnote{color:#0d6ea1;font-size:.8em;vertical-align:super}abbr,acronym{border-bottom:1px dotted #aaa}#wrapper img{max-width:100%;height:auto}dd{font-size:1em;margin-bottom:1em}li>p:first-child{margin:0}ul,ol{padding-left:1.5em}#wrapper ol{list-style-position:inside}ul ul,ul ol{margin-bottom:.4em}caption,col,colgroup,table,tbody,td,tfoot,th,thead,tr{border-spacing:0}table{border:1px solid rgba(0,0,0,0.25);border-collapse:collapse;display:table;empty-cells:hide;margin:-1px 0 1.3125em;padding:0;table-layout:fixed}caption{display:table-caption;font-weight:700}col{display:table-column}colgroup{display:table-column-group}tbody{display:table-row-group}tfoot{display:table-footer-group}thead{display:table-header-group}td,th{display:table-cell}tr{display:table-row}table th,table td{font-size:1.1em;line-height:1.3;padding:.5em 1em 0}table thead{background:rgba(0,0,0,0.15);border:1px solid rgba(0,0,0,0.15);border-bottom:1px solid rgba(0,0,0,0.2)}table tbody{background:rgba(0,0,0,0.05)}table tfoot{background:rgba(0,0,0,0.15);border:1px solid rgba(0,0,0,0.15);border-top:1px solid rgba(0,0,0,0.2)}figure{display:inline-block;overflow:hidden;position:relative;margin:1em 0 2em}figcaption{font-style:italic;text-align:center;background:white;color:#666}.poetry pre{display:block;font-family:Georgia,Garamond,serif !important;font-size:110% !important;font-style:italic;line-height:1.6em;margin-left:1em}.poetry pre code{font-family:Georgia,Garamond,serif !important;word-break:break-all;word-break:break-word;-webkit-hyphens:auto;-moz-hyphens:auto;hyphens:auto;white-space:pre-wrap}blockquote p{font-size:110%;font-style:italic;line-height:1.6em}sup,sub,a.footnote{font-size:1.4ex;height:0;line-height:1;position:relative;vertical-align:super}sub{vertical-align:sub;top:-1px}p,h5{font-size:1.1429em;line-height:1.3125em;margin:1.3125em 0}dt,th{font-weight:700}table tr:nth-child(odd),table th:nth-child(odd),table td:nth-child(odd){background:rgba(255,255,255,0.06)}table tr:nth-child(even),table td:nth-child(even){background:rgba(200,200,200,0.25)}@media print{img,table,figure{page-break-inside:avoid}#wrapper{background:#fff;color:#303030;padding:10px;position:relative;text-indent:0}}@media screen{.inverted{background:#252a2a}.inverted #wrapper{background:#252a2a;color:#eee}.inverted hr{border-color:#333f40 !important}.inverted p,.inverted td,.inverted li,.inverted h1,.inverted h2,.inverted h3,.inverted h4,.inverted h5,.inverted h6,.inverted th,.inverted .math,.inverted caption,.inverted dt,.inverted dd{color:#eee}.inverted pre{background:#ccc;color:#111}.inverted table{background:none}.inverted table tr:nth-child(odd),.inverted table td:nth-child(odd){background:none}.inverted a{color:#acd1d5}::selection{background:rgba(157,193,200,0.5)}h1::selection{background-color:rgba(45,156,208,0.3)}h2::selection{background-color:rgba(90,182,224,0.3)}h3::selection,h4::selection,h5::selection,h6::selection,li::selection,ol::selection{background-color:rgba(133,201,232,0.3)}code::selection{background-color:rgba(0,0,0,0.7);color:#eee}code span::selection{background-color:rgba(0,0,0,0.7) !important;color:#eee !important}a::selection{background-color:rgba(255,230,102,0.2)}.inverted a::selection{background-color:rgba(255,230,102,0.6)}td::selection,th::selection,caption::selection{background-color:rgba(180,237,95,0.5)}}
#mkreplaced-toc{list-style-position:inside;padding:0;margin:0 0 0 1rem;list-style-type:none}#mkreplaced-toc li::before{content:''}#mkreplaced-toc li{font-size:1rem;line-height:1.25;font-weight:normal}#mkreplaced-toc li ul{font-size:1.3rem;font-weight:300;padding:.5rem 0;margin:0 0 0 1rem}#mkreplaced-toc li.missing{list-style-type:none !important}#mkreplaced-toc.max-1 ul,#mkreplaced-toc.max1 ul{display:none}#mkreplaced-toc.max-2 ul ul,#mkreplaced-toc.max2 ul ul{display:none}#mkreplaced-toc.max-3 ul ul ul,#mkreplaced-toc.max3 ul ul ul{display:none}#mkreplaced-toc.max-4 ul ul ul ul,#mkreplaced-toc.max4 ul ul ul ul{display:none}#mkreplaced-toc.max-5 ul ul ul ul ul,#mkreplaced-toc.max5 ul ul ul ul ul{display:none}.rtl{direction:rtl;text-align:right}@media print{body{background:white;line-height:1.4}html,body,#wrapper{max-width:100%;width:100%;-webkit-text-size-adjust:none;-webkit-perspective:none !important;box-sizing:border-box;width:auto;border:0;margin:0;padding:0;float:none;-moz-box-shadow:none !important;-webkit-box-shadow:none !important;box-shadow:none !important}mark{background:transparent !important}h1,h2,h3,h4,h5,h6{page-break-after:avoid}p,h2,h3{orphans:3;widows:3}section{page-break-before:avoid}pre>code{white-space:pre;word-break:break-word}#generated-toc,#firstdiff,#toc-title,#mkdocumentprogress,#mkincludechart,#mkprogressbar1,#mkprogressbar2,.mkscrollmeter,#alllinks,.popup{display:none !important}.suppressprintlinks a{color:inherit !important;text-decoration:none !important;border-bottom:none !important;cursor:default !important}.hrefafterlinktext #wrapper a:link:after,.hrefafterlinktext #wrapper a:visited:after{content:" (" attr(href) ") ";font-size:90%;opacity:0.9}.nocodebreak pre{page-break-inside:avoid}img,table,figure{page-break-inside:avoid}.breakfootnotes .footnotes{page-break-before:always}.breakfootnotes .footnotes hr{display:none}#mktoctitle{display:block}#print-title{display:block;border-bottom:solid 1px #666}#wrapper pre{white-space:pre;white-space:pre-wrap;word-wrap:break-word}#wrapper #generated-toc-clone,#wrapper #mkreplaced-toc{display:block}.task-list .task-list-item{list-style-type:none !important}.task-list .gh-complete.task-list-item .task-list-item-checkbox:before{content:'\2713';background:#838387}.task-list .task-list-item-checkbox{-webkit-appearance:none;position:relative}.task-list .task-list-item-checkbox:before{content:' ';border:solid 1px #aaa;width:1em;height:1em;display:block;border-radius:2px;left:-20px;top:-.75em;color:white;font-weight:bold;line-height:1;text-align:center;position:absolute}}
#wrapper #generated-toc-clone,#wrapper #mkreplaced-toc,#wrapper #generated-toc-clone ul,#wrapper #mkreplaced-toc ul{list-style-position:inside}#wrapper #generated-toc-clone li.missing,#wrapper #mkreplaced-toc li.missing{list-style-type: none!important}#wrapper #generated-toc-clone,#wrapper #mkreplaced-toc{list-style-type: upper-roman}#wrapper #generated-toc-clone>li>ul,#wrapper #mkreplaced-toc>li>ul {list-style-type: decimal}#wrapper #generated-toc-clone>li>ul>li>ul,#wrapper #mkreplaced-toc>li>ul>li>ul{list-style-type: decimal-leading-zero}#wrapper #generated-toc-clone>li>ul>li>ul>li>ul,#wrapper #mkreplaced-toc>li>ul>li>ul>li>ul{list-style-type: lower-greek}#wrapper #generated-toc-clone>li>ul>li>ul>li>ul>li>ul,#wrapper #mkreplaced-toc>li>ul>li>ul>li>ul>li>ul{list-style-type: disc}#wrapper #generated-toc-clone>li>ul>li>ul>li>ul>li>ul>li>ul,#wrapper #mkreplaced-toc>li>ul>li>ul>li>ul>li>ul>li>ul{list-style-type: square}#wrapper #generated-toc-clone,#wrapper #mkreplaced-toc{list-style-position:outside!important;margin-left:2rem;}
</style>

<style id="mkprintstyles">@media print{#wrapper #generated-toc-clone,#generated-toc{display:none!important}
html,body,#wrapper{font-size:10pt!important}
}
</style>


</head>
<body class="normal firstload">
  <div id="wrapper">
      <h1 id="chapter12:creatingamoduleandperformingunittests">Chapter 12: Creating A Module and Performing Unit Tests</h1>

<p><a href="../index.html">Return to all notes</a></p>

<p>In <a href="ch06.html">Chapter 6</a> we learned about adding and loading packages or modules. These were generally official ones. In this section, we will now learn how to write our own module. We will learn how to do this by creating a <code>PlayingCards</code> module with all of the types and functions associated with it. It is helpful to read through the <a href="http://docs.julialang.org/en/release-0.5/manual/modules/">julia documentation on modules</a>.</p>

<p>To begin with, let&#8217;s look at a module template:</p>
<pre><code class="(null)">module PlayingCards

export Card,print_card,Hand,print_hand,is_full_house

##definitions of types and functions

end</code></pre>

<p>As you can see above, a module has a name (in this case <code>PlayingCards</code>) and ends with the keyword <code>end</code>. We will next put a number of types and functions inside the module, but in order for someone loading the module, you need to export anything to be used.</p>

<p>The following is a more detailed version of the module:</p>
<pre><code class="(null)">module PlayingCards

export Card,print_card,Hand,print_hand,is_full_house

ranks = [&apos;A&apos;,&apos;2&apos;,&apos;3&apos;,&apos;4&apos;,&apos;5&apos;,&apos;6&apos;,&apos;7&apos;,&apos;8&apos;,&apos;9&apos;,&apos;T&apos;,&apos;J&apos;,&apos;Q&apos;,&apos;K&apos;]
suits = [&apos;\u2660&apos;,&apos;\u2661&apos;,&apos;\u2662&apos;,&apos;\u2663&apos;]


type Card
    rank::Int
    suit::Int

    # construct a card based on the rank and suit
    function Card(r::Int,s::Int)
        if r&lt;1||r&gt;13
            throw(ArgumentError(&quot;The rank must be an integer between 1 and 13.&quot;))
        end
        if s&lt;1||s&gt;4
            throw(ArgumentError(&quot;The suit must be an integer between 1 and 4.&quot;))
        end
        new(r,s)
    end

    # construct a card based on the number in a deck
    function Card(i::Int)
        if i&lt;1||i&gt;52
            throw(ArgumentError(&quot;The argument must be an integer between 1 and 52&quot;))
        end
        if i%13==0
            new(13,div(i,13))
        else
            new(i%13,div(i,13)+1)
        end
    end

    # construct a card based on a string representation of the card
    function Card(str::String)
        if length(str)&gt;2
            throw(ArgumentError(&quot;The string should only be 2 characters&quot;))
        end
        local r = findfirst(a-&gt;a==str[1],ranks)
        if r&lt;1 || r&gt;13
            throw(ArgumentError(string(&quot;The first character should be one of &quot;,join(ranks,&quot;,&quot;))))
        end
        local s=findfirst(a-&gt;a==str[2],suits)
        if s&lt;1 || s&gt;4
            throw(ArgumentError(string(&quot;The second character should be one of &quot;,join(suits,&quot;,&quot;))))
        end
        new(r,s)
    end

end

function print_card(c::Card)
    string(ranks[c.rank],suits[c.suit]);
end

function card_rank(c::Card)
    return c.rank
end

function card_suit(c::Card)
    return c.suit
end

type Hand
    cards::Array{Card,1}
    Hand(c::Array{Card,1})=new(c)
    Hand(c::Array{String,1})=new(map(Card,c))
    Hand(s::String)=new(map(Card,map(String,split(s,&apos;,&apos;))))
end

function print_hand(h::Hand)
    join(map(print_card,h.cards),&quot;,&quot;)
end

function is_full_house(h::Hand)
    local cranks=sort(map(card_rank,h.cards))
    return cranks[2]==cranks[1] &amp;&amp; cranks[5]==cranks[4] &amp;&amp; (cranks[3]==cranks[2] || cranks[4]==cranks[3]);
end

end</code></pre>

<p>Open a new file in jupyter or juliabox and copy-paste the above module into the empty file. It will need to be called <code>PlayingCards.jl</code>.</p>

<h4 id="changingtheload_pathvariable">Changing the LOAD_PATH variable</h4>

<p>Julia looks for modules in a few directories on your computer. If you type</p>
<pre><code class="(null)">LOAD_PATH</code></pre>

<p>in an empty ipynb file, it will return an array of directories where the modules are located. The module that you wrote however, is probably in the same directory as the ipynb files. If this is going to be the situation, typing</p>
<pre><code class="(null)">push!(LOAD_PATH, &quot;.&quot;)</code></pre>

<p>will add the &#8220;.&#8221; directory (current one) to the <code>LOAD_PATH</code> array. Then julia will be able to find it.</p>

<h4 id="loadingthemodule">Loading the module</h4>

<p>Next, we will load the module in as before.</p>
<pre><code class="(null)">using PlayingCards</code></pre>

<p>will now load in the module. </p>

<h4 id="bestpracticesforcreatingmodules">Best practices for creating modules</h4>

<ul>
<li><p>You should test all of your code before putting it in a module. It&#8217;s difficult to debug once it is in a module.</p></li>
<li><p>Typing <code>using PlayingCards</code> does not reload all of the code. If you need to reload it, you should type <code>reload(&quot;PlayingCards&quot;)</code>.</p></li>
<li><p>The above is supposed, but I have found doesn&#8217;t always work. You may need to do a <code>workspace()</code> command and reload using <code>using PlayingCards</code>. </p></li>
<li><p>Make sure that you <code>export</code> only types and functions that you want to make available. Notice in the example above, we have variables called <code>ranks</code> and <code>suits</code> that are not exported and do not need to be exported. </p></li>
</ul>

<h2 id="unittests">Unit Tests</h2>

<p>Writing a module is important, but making sure it does what it is supposed to is just as important. The notion of a unit test is a set of tests to determine if you get out from the code what you expect. To run a test, first import the <code>Base.Test</code> package:</p>
<pre><code class="(null)">using Base.Test</code></pre>

<p>To do a test, we&#8217;ll use the <code>@test</code> macro. For this module, let&#8217;s first test that the constructor is working and for this we will need a way to test if two Cards are equal.</p>
<pre><code class="(null)">function isequal(x::Card,y::Card)
  x.rank==y.rank&amp;&amp;x.suit==y.suit
end</code></pre>

<p>then create two cards</p>
<pre><code class="(null)">c1=Card(4,1)</code></pre>
<pre><code class="(null)">c2=Card(4)</code></pre>

<p>and test if they are the same with</p>
<pre><code class="(null)">@test isequal(c1,c2)</code></pre>

<p>and let&#8217;s also check if some cards deeper in the deck are working:</p>
<pre><code class="(null)">c3=Card(7,3);
c4=Card(33);</code></pre>
<pre><code class="(null)">@test isequal(c3,c4)</code></pre>

<h4 id="testifanexceptionisthrown">Test if an exception is thrown</h4>

<p>It&#8217;s also important to test if an exception is thrown for creating illegal cards. For example, a <code>Card(0,3)</code> does not exist and will throw an exception (try it!). To test this,</p>
<pre><code class="(null)">@test_throws ArgumentError Card(0,3)</code></pre>

<p>returns</p>
<pre><code class="(null)">Test Passed
  Expression: Card(0,3)
      Thrown: ArgumentError</code></pre>

<h3 id="puttingalltestsinafile">Putting all tests in a file</h3>

<p>The <a href="test-playing-cards.jl">Playing Card test file</a> is a better way to run a set of tests. To use this, download the file, put it in the current directory of juliabox or jupyter and then run it with:</p>
<pre><code class="(null)">include(&quot;test-playing-cards.jl&quot;)</code></pre>

<p>and you should see:</p>
<pre><code class="(null)">Test Summary:      | Pass  Total
  Playing Card Tests |    5      5</code></pre>

<p>printed out. </p>
<!-- ##END MARKED WRAPPER## -->
    </div>



<div style="display:none" markdown="0">
<!--This seemingly unnecessary div markup is the only thing keeping this script working after Markdown conversion. Trust me.-->
 <script type="text/x-mathjax-config">
  MathJax.Hub.Config();
</script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</div>


<script>(function(factory){if(typeof define==="function"&&define.amd){define("bidi_helpers",[],factory)}else{window.bidi_helpers=factory()}})(function(){var module={};module.Dir={RTL:-1,UNKNOWN:0,LTR:1};module.Format={LRE:"\u202A",RLE:"\u202B",PDF:"\u202C",LRM:"\u200E",RLM:"\u200F"};module.ltrChars_="A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02B8\u0300-\u0590\u0800-\u1FFF\u2C00-\uFB1C\uFE00-\uFE6F\uFEFD-\uFFFF";module.rtlChars_="\u0591-\u07FF\uFB1D-\uFDFF\uFE70-\uFEFC";module.ltrDirCheckRe_=new RegExp("^[^"+module.rtlChars_+"]*["+module.ltrChars_+"]");module.ltrCharReg_=new RegExp("["+module.ltrChars_+"]");module.hasAnyLtr=function(text){return module.ltrCharReg_.test(text)};module.rtlDirCheckRe_=new RegExp("^[^"+module.ltrChars_+"]*["+module.rtlChars_+"]");module.rtlRe=module.rtlDirCheckRe_;module.isRtlText=function(text){return module.rtlDirCheckRe_.test(text)};module.isLtrText=function(text){return module.ltrDirCheckRe_.test(text)};module.isRequiredLtrRe_=/^http:\/\/.*/;module.hasNumeralsRe_=/\d/;module.estimateDirection=function(text,detectionThreshold){var rtlCount=0;var totalCount=0;var hasWeaklyLtr=false;var tokens=text.split(/\s+/);for(var i=0;i<tokens.length;i++){var token=tokens[i];if(module.isRtlText(token)){rtlCount++;totalCount++}else{if(module.isRequiredLtrRe_.test(token)){hasWeaklyLtr=true}else{if(module.hasAnyLtr(token)){totalCount++}else{if(module.hasNumeralsRe_.test(token)){hasWeaklyLtr=true}}}}}return totalCount==0?(hasWeaklyLtr?module.Dir.LTR:module.Dir.UNKNOWN):(rtlCount/totalCount>detectionThreshold?module.Dir.RTL:module.Dir.LTR)};return module});(function(factory){if(typeof define==="function"&&define.amd){define("bidiweb",["bidi_helpers"],factory)}else{window.bidiweb=factory(bidi_helpers)}})(function(bidi_helpers){var module={};var IProcessor={makeRtl:function(element){},makeLtr:function(element){}};var css_processor=function(classes){return{makeRtl:function(element){element.classList.add(classes.rtl)},makeLtr:function(element){element.classList.add(classes.ltr)}}};var style_processor=function(falign){return{makeRtl:function(element){element.style.direction="rtl";if(falign){element.style.textAlign="right"}},makeLtr:function(element){element.style.direction="ltr";if(falign){element.style.textAlign="left"}}}};module.processors={css:css_processor,style:style_processor};var nodeListMock=function(node){var list=[node];list.item=function(i){return list[i]};return list};module.process=function(query,processor){var elements;if(query instanceof NodeList){elements=query}else{if(query instanceof Node){elements=nodeListMock(query)}else{elements=document.querySelectorAll(query)}}module.process_elements(elements,processor);return elements};module.process_elements=function(elements,processor){for(var index=0;index<elements.length;index++){var element=elements.item(index);var text=element.textContent||element.value||element.placeholder||"";var dir=bidi_helpers.estimateDirection(text,0.4);if(dir==bidi_helpers.Dir.RTL){processor.makeRtl(element)}else{if(dir==bidi_helpers.Dir.LTR){processor.makeLtr(element)}}}};module.process_css=function(query,classes){var proc=module.processors.css(classes);return module.process(query,proc)};module.process_style=function(query,falign){var proc=module.processors.style(falign);return module.process(query,proc)};module.style=function(query){return module.process_style(query,true)};module.css=function(query){return module.process_css(query,{rtl:"rtl",ltr:"ltr"})};module.htmlToElement=function(html){var container=document.createElement("div");container.innerHTML=html;return container};module.html_css=function(html){var container=module.htmlToElement(html);var nodes=container.querySelectorAll("*");module.css(nodes);return container.innerHTML};module.html_style=function(html){var container=module.htmlToElement(html);var nodes=container.querySelectorAll("*");module.style(nodes);return container.innerHTML};return module});</script>

</body>
</html>