<!DOCTYPE html>  
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <title>ch10</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style id="mkstylesheet">
body{-webkit-font-smoothing:antialiased;font-family:"Helvetica Neue",Helvetica,Arial,Verdana,sans-serif;margin:30px 0 0;padding:0;background:#fff}#wrapper{padding:20px}li{font-size:110%}li li{font-size:100%}li p{font-size:100%;margin:.5em 0}h1{color:#000}h2{color:#111}h3{color:#111;margin:0}h4{color:#111}h5{color:#111}h6{font-size:1em;line-height:1.5em;margin:1.5em 0}body,p,td,div{color:#111;font-family:"Helvetica Neue",Helvetica,Arial,Verdana,sans-serif;word-wrap:break-word}a{color:#0d6ea1;text-decoration:none;-webkit-transition:color .2s ease-in-out;-moz-transition:color .2s ease-in-out;-o-transition:color .2s ease-in-out;-ms-transition:color .2s ease-in-out;transition:color .2s ease-in-out}a:hover{color:#3593d9}body{font-size:15px;line-height:21px;margin:0 auto}h1{font-size:37px;line-height:42px;margin-top:42px;margin-bottom:21px}h2{font-size:27px;line-height:42px;margin-top:42px;margin-bottom:21px}h3{font-size:20px;line-height:21px;margin-top:21px;margin-bottom:21px}h4{font-size:20px;line-height:21px;margin-top:21px;margin-bottom:21px}p,ul,ol,pre,table,blockquote{margin-top:21px;margin-bottom:21px}hr{border:1px solid;margin:-1px 0}ul ul,ol ol,ul ol,ol ul{margin-top:0;margin-bottom:0}b,strong,em,small,code{line-height:1}.footnote{color:#0d6ea1;font-size:.8em;vertical-align:super}abbr,acronym{border-bottom:1px dotted #aaa}#wrapper img{max-width:100%;height:auto}dd{font-size:1em;margin-bottom:1em}li>p:first-child{margin:0}ul,ol{padding-left:1.5em}#wrapper ol{list-style-position:inside}ul ul,ul ol{margin-bottom:.4em}caption,col,colgroup,table,tbody,td,tfoot,th,thead,tr{border-spacing:0}table{border:1px solid rgba(0,0,0,0.25);border-collapse:collapse;display:table;empty-cells:hide;margin:-1px 0 1.3125em;padding:0;table-layout:fixed}caption{display:table-caption;font-weight:700}col{display:table-column}colgroup{display:table-column-group}tbody{display:table-row-group}tfoot{display:table-footer-group}thead{display:table-header-group}td,th{display:table-cell}tr{display:table-row}table th,table td{font-size:1.1em;line-height:1.3;padding:.5em 1em 0}table thead{background:rgba(0,0,0,0.15);border:1px solid rgba(0,0,0,0.15);border-bottom:1px solid rgba(0,0,0,0.2)}table tbody{background:rgba(0,0,0,0.05)}table tfoot{background:rgba(0,0,0,0.15);border:1px solid rgba(0,0,0,0.15);border-top:1px solid rgba(0,0,0,0.2)}figure{display:inline-block;overflow:hidden;position:relative;margin:1em 0 2em}figcaption{font-style:italic;text-align:center;background:white;color:#666}.poetry pre{display:block;font-family:Georgia,Garamond,serif !important;font-size:110% !important;font-style:italic;line-height:1.6em;margin-left:1em}.poetry pre code{font-family:Georgia,Garamond,serif !important;word-break:break-all;word-break:break-word;-webkit-hyphens:auto;-moz-hyphens:auto;hyphens:auto;white-space:pre-wrap}blockquote p{font-size:110%;font-style:italic;line-height:1.6em}sup,sub,a.footnote{font-size:1.4ex;height:0;line-height:1;position:relative;vertical-align:super}sub{vertical-align:sub;top:-1px}p,h5{font-size:1.1429em;line-height:1.3125em;margin:1.3125em 0}dt,th{font-weight:700}table tr:nth-child(odd),table th:nth-child(odd),table td:nth-child(odd){background:rgba(255,255,255,0.06)}table tr:nth-child(even),table td:nth-child(even){background:rgba(200,200,200,0.25)}@media print{img,table,figure{page-break-inside:avoid}#wrapper{background:#fff;color:#303030;padding:10px;position:relative;text-indent:0}}@media screen{.inverted{background:#252a2a}.inverted #wrapper{background:#252a2a;color:#eee}.inverted hr{border-color:#333f40 !important}.inverted p,.inverted td,.inverted li,.inverted h1,.inverted h2,.inverted h3,.inverted h4,.inverted h5,.inverted h6,.inverted th,.inverted .math,.inverted caption,.inverted dt,.inverted dd{color:#eee}.inverted pre{background:#ccc;color:#111}.inverted table{background:none}.inverted table tr:nth-child(odd),.inverted table td:nth-child(odd){background:none}.inverted a{color:#acd1d5}::selection{background:rgba(157,193,200,0.5)}h1::selection{background-color:rgba(45,156,208,0.3)}h2::selection{background-color:rgba(90,182,224,0.3)}h3::selection,h4::selection,h5::selection,h6::selection,li::selection,ol::selection{background-color:rgba(133,201,232,0.3)}code::selection{background-color:rgba(0,0,0,0.7);color:#eee}code span::selection{background-color:rgba(0,0,0,0.7) !important;color:#eee !important}a::selection{background-color:rgba(255,230,102,0.2)}.inverted a::selection{background-color:rgba(255,230,102,0.6)}td::selection,th::selection,caption::selection{background-color:rgba(180,237,95,0.5)}}
#mkreplaced-toc{list-style-position:inside;padding:0;margin:0 0 0 1rem;list-style-type:none}#mkreplaced-toc li::before{content:''}#mkreplaced-toc li{font-size:1rem;line-height:1.25;font-weight:normal}#mkreplaced-toc li ul{font-size:1.3rem;font-weight:300;padding:.5rem 0;margin:0 0 0 1rem}#mkreplaced-toc li.missing{list-style-type:none !important}#mkreplaced-toc.max-1 ul,#mkreplaced-toc.max1 ul{display:none}#mkreplaced-toc.max-2 ul ul,#mkreplaced-toc.max2 ul ul{display:none}#mkreplaced-toc.max-3 ul ul ul,#mkreplaced-toc.max3 ul ul ul{display:none}#mkreplaced-toc.max-4 ul ul ul ul,#mkreplaced-toc.max4 ul ul ul ul{display:none}#mkreplaced-toc.max-5 ul ul ul ul ul,#mkreplaced-toc.max5 ul ul ul ul ul{display:none}.rtl{direction:rtl;text-align:right}@media print{body{background:white;line-height:1.4}html,body,#wrapper{max-width:100%;width:100%;-webkit-text-size-adjust:none;-webkit-perspective:none !important;box-sizing:border-box;width:auto;border:0;margin:0;padding:0;float:none;-moz-box-shadow:none !important;-webkit-box-shadow:none !important;box-shadow:none !important}mark{background:transparent !important}h1,h2,h3,h4,h5,h6{page-break-after:avoid}p,h2,h3{orphans:3;widows:3}section{page-break-before:avoid}pre>code{white-space:pre;word-break:break-word}#generated-toc,#firstdiff,#toc-title,#mkdocumentprogress,#mkincludechart,#mkprogressbar1,#mkprogressbar2,.mkscrollmeter,#alllinks,.popup{display:none !important}.suppressprintlinks a{color:inherit !important;text-decoration:none !important;border-bottom:none !important;cursor:default !important}.hrefafterlinktext #wrapper a:link:after,.hrefafterlinktext #wrapper a:visited:after{content:" (" attr(href) ") ";font-size:90%;opacity:0.9}.nocodebreak pre{page-break-inside:avoid}img,table,figure{page-break-inside:avoid}.breakfootnotes .footnotes{page-break-before:always}.breakfootnotes .footnotes hr{display:none}#mktoctitle{display:block}#print-title{display:block;border-bottom:solid 1px #666}#wrapper pre{white-space:pre;white-space:pre-wrap;word-wrap:break-word}#wrapper #generated-toc-clone,#wrapper #mkreplaced-toc{display:block}.task-list .task-list-item{list-style-type:none !important}.task-list .gh-complete.task-list-item .task-list-item-checkbox:before{content:'\2713';background:#838387}.task-list .task-list-item-checkbox{-webkit-appearance:none;position:relative}.task-list .task-list-item-checkbox:before{content:' ';border:solid 1px #aaa;width:1em;height:1em;display:block;border-radius:2px;left:-20px;top:-.75em;color:white;font-weight:bold;line-height:1;text-align:center;position:absolute}}
#wrapper #generated-toc-clone,#wrapper #mkreplaced-toc,#wrapper #generated-toc-clone ul,#wrapper #mkreplaced-toc ul{list-style-position:inside}#wrapper #generated-toc-clone li.missing,#wrapper #mkreplaced-toc li.missing{list-style-type: none!important}#wrapper #generated-toc-clone,#wrapper #mkreplaced-toc{list-style-type: upper-roman}#wrapper #generated-toc-clone>li>ul,#wrapper #mkreplaced-toc>li>ul {list-style-type: decimal}#wrapper #generated-toc-clone>li>ul>li>ul,#wrapper #mkreplaced-toc>li>ul>li>ul{list-style-type: decimal-leading-zero}#wrapper #generated-toc-clone>li>ul>li>ul>li>ul,#wrapper #mkreplaced-toc>li>ul>li>ul>li>ul{list-style-type: lower-greek}#wrapper #generated-toc-clone>li>ul>li>ul>li>ul>li>ul,#wrapper #mkreplaced-toc>li>ul>li>ul>li>ul>li>ul{list-style-type: disc}#wrapper #generated-toc-clone>li>ul>li>ul>li>ul>li>ul>li>ul,#wrapper #mkreplaced-toc>li>ul>li>ul>li>ul>li>ul>li>ul{list-style-type: square}#wrapper #generated-toc-clone,#wrapper #mkreplaced-toc{list-style-position:outside!important;margin-left:2rem;}
</style>

<style id="mkprintstyles">@media print{#wrapper #generated-toc-clone,#generated-toc{display:none!important}
html,body,#wrapper{font-size:10pt!important}
}
</style>


</head>
<body class="normal firstload">
  <div id="wrapper">
      <h1 id="chapter10:randomnumbersandmontecarlosimulations">Chapter 10: Random Numbers and Monte Carlo Simulations</h1>

<p><a href="../index.html">Return to all notes</a></p>

<h2 id="montecarlosimulations">Monte Carlo Simulations</h2>

<p>One big part of scientific computation is the subject of Monte Carlo simulations in which random numbers are used to model some situation. We&#8217;ll spend the next part of this course covering this subject. </p>

<h2 id="probability">Probability</h2>

<p>To fully understand how to use random numbers and how Monte Carlo simulations work, we need some basic probability. When understanding probability there are two types continuous and discrete, which for what we need will come down to using floating point or integers.</p>

<h3 id="discreteprobability">Discrete Probability</h3>

<p>We&#8217;ll first discuss discrete probability. A <em>discrete probability distribution</em> is a finite set (often will be a subset of integers.) For example, let&#8217;s use the set</p>

<p><span class="math">\[A=\{1,2,3,4,5,6\}\]</span></p>

<p>and an event, <span class="math">\(X\)</span> is subset of these numbers. For example, let <span class="math">\(X=\{1\}\)</span>, then the probability that this event occurs in the ratio of the number of elements in each set or<br/>
<span class="math">\[P(X)=\frac{N(X)}{N(A)}\]</span></p>

<p>In this case, <span class="math">\(P(X)=1/6\)</span> and that means that the probability that the number 1 comes up is 1/6. Think about this in the case of rolling a die. This says that the probability that 1 comes up is 1/6. </p>

<h3 id="continuousprobability">Continuous Probability</h3>

<p>Another type of probability distribution is called a continuous distribution and in this case we&#8217;ll only consider a type of continuous probability distribution called a uniform distribution.</p>

<p>Let&#8217;s consider a set <span class="math">\(A=\{x \; | \; 0 \leq x \leq 1\}\)</span> or all real numbers between 0 and 1. Events are still subsets of the set <span class="math">\(A\)</span>, however the probability that events occur is the fraction of the set. </p>

<p>For example, if <span class="math">\(X=\{x \; | \; 1/3 \leq x \leq 1/2\}\)</span>, then <span class="math">\(P(X)\)</span> is the fraction<br/>
<span class="math">\[P(X) = \frac{\frac{1}{2}-\frac{1}{3}}{1-0}=\frac{1}{6}\]</span></p>

<h2 id="pseudorandomnumbergenerator">Pseudo Random Number Generator</h2>

<p><a href="https://en.wikipedia.org/wiki/Pseudorandom_number_generator">The Wikipedia Pseudo-random Number Generator page</a> gives an overview of the subject and a lot of technical details. In short, a truly random number on a computer is very difficult to generate and generally not necessary because a pseudorandom number is sufficient. I also won&#8217;t try to explain this in general term since you&#8217;d need a significant mathematical background.</p>

<p>A pseudo-random number generator is a function that produces a sequence of numbers that act like random numbers. Let&#8217;s examine what this means in terms of the discrete probability with set <span class="math">\(A=\{1,2,3,4,5,6\}\)</span>. </p>

<p>If a pseudo-random number generator produces a sequence from this set then the sequence should have the following property:</p>

<ul>
<li>If the event <span class="math">\(X=\{i\}\)</span> for any <span class="math">\(i\)</span> between 1 and 6, then <span class="math">\(P(X)\approx 1/6\)</span>. And by approximately, as the sequence gets larger, the approximation becomes closer to 1/6.</li>
</ul>

<p>Is this enough? No, the sequence<br/>
<span class="math">\[\{1,2,3,4,5,6,1,2,3,4,5,6,\ldots\}\]</span></p>

<p>satisfies the above property, but I don&#8217;t think anyone would consider this random. Another property would be:</p>

<ul>
<li>If we know the sequence <span class="math">\(\{a_1,a_2,a_3,\ldots,a_n\}\)</span> then we can&#8217;t predict the next number <span class="math">\(a_{n+1}\)</span>.</li>
</ul>

<p>This is obviously violated in the sequence above. </p>

<p>A little more technical definition of a sequence of pseudo-random numbers Let <span class="math">\((a_1,a_2,a_3, \ldots, \)</span> be a random sequence. Typically we mean the following properties need to hold:</p>

<ol>
<li>any number in the range 1 to 6 is equally likely to occur.</li>
<li>Take N random numbers and let <span class="math">\(s_n\)</span> be the number of times the number <span class="math">\(n\)</span> occurs. The fraction <span class="math">\(s_n/N\)</span> should go to 1/6 in the limit as <span class="math">\( n\rightarrow \infty \)</span>.</li>
<li>Knowing the sequence <span class="math">\(s_1, s_2, \ldots, s_k\)</span> does not allow us to predict <span class="math">\(s_{k+1}\)</span></li>
</ol>

<p>If instead we use floating point numbers, there are a few different properties. Assume that the floating point number is in the range <span class="math">\( 0 \lt x \lt 1 \)</span>. Then the sequence <span class="math">\((a_1,a_2,a_3, \ldots, \)</span> is random if</p>

<ol>
<li>Let <span class="math">\(s_{[c,d]}(a_1,a_2,a_3, \ldots) \)</span> be the total of the numbers that satisfy <span class="math">\(c \lt a_k \lt d\)</span>. Then as the number of random numbers approach infinity <span class="math">\(s_{[c,d]}=d-c\)</span></li>
</ol>

<h2 id="usingjuliatosimulatetherollingofadie">Using Julia to simulate the rolling of a die</h2>

<p>First, the main commands that are built-in to Julia are listed in the <a href="http://docs.julialang.org/en/release-0.5/stdlib/base/?highlight=findfirst#random-numbers">Julia Manual for Random Numbers</a>. We can generate 100 random numbers between 1 and 6 using</p>
<pre><code class="(null)">S=rand(1:6,100)</code></pre>

<p>and notice that if you rerun the command, you&#8217;ll get a different sequence of random numbers. We can check that this is doing what we expect by checking the probability that we get a 1 (or any other number).</p>

<p>To check the count of the number 1 that appears, try</p>
<pre><code class="(null)">count(a-&gt;a==1,S)</code></pre>

<h3 id="exercise">Exercise</h3>

<p>Convert this to a probability. Is it close to what you expect? Try changing the number of random numbers used to larger numbers. Does your answer get closer to what you expect? </p>

<h2 id="floatingpointrandomnumbers">Floating Point random numbers</h2>

<p>Let&#8217;s look a floating point random numbers between 0 and 1. To generate a sequence (array) of such numbers, type</p>
<pre><code class="(null)">S=rand(100)</code></pre>

<p>and we can check the number of values less than 0.1 with the command:</p>
<pre><code class="(null)">count(a-&gt;a&lt;0.1,S)</code></pre>

<p>and if we want the number of values between 0.4 and 0.7 then type</p>
<pre><code class="(null)">count(a-&gt;0.4&lt;a&lt;0.7,S)</code></pre>

<h3 id="exercise">Exercise</h3>

<p>Change the number of random numbers used to much larger set and return the above commands. What are the results? Is this what you expect?</p>

<p>How to do find the fraction of number that are less that 0.25 and greater than 0.75?</p>

<h2 id="themapslicescommands">The <code>mapslices</code> commands</h2>

<p>Below we will encounter another nice function that we can use with arrays. If we have the following array:</p>
<pre><code class="(null)">A = [1 2 3; 4 5 6; 7 8 9]</code></pre>

<p>and we wish to sum the rows. For any given row, this isn&#8217;t difficult. If we want to do all of the rows and return a 1D array (vector), we can use the <code>mapslices</code> function. See <a href="http://docs.julialang.org/en/release-0.5/stdlib/arrays/#Base.mapslices">the julia documentatation on mapslices</a>.</p>
<pre><code class="(null)">mapslices(sum,A,[2])</code></pre>

<p>returns the vector <code>[6,15,24]</code> which are the row sums and</p>
<pre><code class="(null)">mapslices(sum,A,[1])</code></pre>

<p>returns the vector <code>[12,15,18]</code> or the column sums. </p>

<h3 id="exercise">Exercise</h3>

<p>For the matrix above, find the result if you multiply the rows together. Do the same for the columns. </p>

<h2 id="otherexamples">Other Examples</h2>

<h3 id="rolling2dice">Rolling 2 dice</h3>

<p>How do we handle the rolling of two dice? Here&#8217;s an array with each row having 2 dice.</p>
<pre><code class="(null)">S=rand(1:6,100,2)</code></pre>

<p>and then to find the sum of the dice:</p>
<pre><code class="(null)">dicesum = mapslices(sum,S,[2])</code></pre>

<p>which sums along the rows. This is 100 rolls of 2 dice with the sum recorded. First, to get an idea of the distribution of the dice sums, let&#8217;s plot the results using Gadfly. So first, load it in</p>
<pre><code class="(null)">using Gadfly</code></pre>

<p>and then to plot the sum</p>
<pre><code class="(null)">plot(x=dicesum,Geom.histogram)</code></pre>

<p>generates the following plot:</p>

<figure>
<img src="images/ch10/plot01.png" alt="distribution of the sum of 100 rolls of pairs of dice" />
<figcaption>distribution of the sum of 100 rolls of pairs of dice</figcaption>
</figure>

<p>We could find the number of 2&#8217;s 3&#8217;s, etc. using the <code>mapslices</code> function as above, however there is a nice way to do this use the <code>StatsBase</code> package. You may need to add the package and then load it with</p>
<pre><code class="(null)">using StatsBase</code></pre>

<p>and then the <code>counts</code> function ( <a href="http://statsbasejl.readthedocs.io/en/latest/counts.html">Read the online documentation</a>) can be used:</p>
<pre><code class="(null)">counts(dicesum,2:12)</code></pre>

<p>returns a vector of how many of the dice sum fall into each number. </p>

<h3 id="exercise">Exercise</h3>

<p>Change the code above to use 1000 dice rolls. Estimate the probability that you</p>

<ul>
<li>roll a 7.</li>
<li>roll a 10 or greater.</li>
<li>roll an even number.</li>
</ul>

<p>Plot a the histogram using 1000 dice rolls. </p>

<h2 id="calculatingpiusingpseudorandomnumbers">Calculating <span class="math">\(\pi\)</span> using pseudo random numbers</h2>

<ul>
<li><p><a href="https://en.wikipedia.org/wiki/Buffon%27s_needle">Buffon&#8217;s Needle Experiment (18th C.)</a> </p></li>
<li><p>Circle in the Square. </p>

<p>Consider the square <span class="math">\(\{ (x,y)\; | \; 0\leq x\leq 1, 0 \leq y \leq 1\}\)</span> and the quarter circle that falls within <span class="math">\( x^{2}+y^{2} \leq 1\)</span>. The area within the circle is the fraction of the cirle in the square or <span class="math">\(\pi/4\)</span>.</p>

<p>We can use this to estimate a value of <span class="math">\(\pi\)</span>. </p>

<ol>
<li>Randomly choose points <span class="math">\(x\)</span> and <span class="math">\(y\)</span> in the range [0,1].</li>
<li>Count all points that fall within the circle.</li>
<li>Find the fraction of the points in the circle.</li>
<li>Since this fraction should be <span class="math">\(\pi/4\)</span>, multiply by 4 to estimate <span class="math">\(\pi\)</span>.</li>
</ol>

<p>This can be done in julia using<br/>
1. <code>S1=rand(100,2)</code><br/>
2. <code>S2=count(a-&gt;a&lt;1,mapslices(a-&gt;a[1]^2+a[2]^2,S1,[2]))</code> or<br/>
 <code>S2=count(a-&gt;a&lt;1,mapslices(sumabs2,S1,[2]))</code><br/>
3. <code>fr=S2/100</code><br/>
4. <code>est=4*fr</code></p>

<p>or combine all of these into one command:</p>
<pre><code class="(null)">4*count(a-&gt;a&lt;1,mapslices(sumabs2,rand(100,2),[2]))/100</code></pre></li>
</ul>
<!-- ##END MARKED WRAPPER## -->
    </div>



<div style="display:none" markdown="0">
<!--This seemingly unnecessary div markup is the only thing keeping this script working after Markdown conversion. Trust me.-->
 <script type="text/x-mathjax-config">
  MathJax.Hub.Config();
</script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</div>


<script>(function(factory){if(typeof define==="function"&&define.amd){define("bidi_helpers",[],factory)}else{window.bidi_helpers=factory()}})(function(){var module={};module.Dir={RTL:-1,UNKNOWN:0,LTR:1};module.Format={LRE:"\u202A",RLE:"\u202B",PDF:"\u202C",LRM:"\u200E",RLM:"\u200F"};module.ltrChars_="A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02B8\u0300-\u0590\u0800-\u1FFF\u2C00-\uFB1C\uFE00-\uFE6F\uFEFD-\uFFFF";module.rtlChars_="\u0591-\u07FF\uFB1D-\uFDFF\uFE70-\uFEFC";module.ltrDirCheckRe_=new RegExp("^[^"+module.rtlChars_+"]*["+module.ltrChars_+"]");module.ltrCharReg_=new RegExp("["+module.ltrChars_+"]");module.hasAnyLtr=function(text){return module.ltrCharReg_.test(text)};module.rtlDirCheckRe_=new RegExp("^[^"+module.ltrChars_+"]*["+module.rtlChars_+"]");module.rtlRe=module.rtlDirCheckRe_;module.isRtlText=function(text){return module.rtlDirCheckRe_.test(text)};module.isLtrText=function(text){return module.ltrDirCheckRe_.test(text)};module.isRequiredLtrRe_=/^http:\/\/.*/;module.hasNumeralsRe_=/\d/;module.estimateDirection=function(text,detectionThreshold){var rtlCount=0;var totalCount=0;var hasWeaklyLtr=false;var tokens=text.split(/\s+/);for(var i=0;i<tokens.length;i++){var token=tokens[i];if(module.isRtlText(token)){rtlCount++;totalCount++}else{if(module.isRequiredLtrRe_.test(token)){hasWeaklyLtr=true}else{if(module.hasAnyLtr(token)){totalCount++}else{if(module.hasNumeralsRe_.test(token)){hasWeaklyLtr=true}}}}}return totalCount==0?(hasWeaklyLtr?module.Dir.LTR:module.Dir.UNKNOWN):(rtlCount/totalCount>detectionThreshold?module.Dir.RTL:module.Dir.LTR)};return module});(function(factory){if(typeof define==="function"&&define.amd){define("bidiweb",["bidi_helpers"],factory)}else{window.bidiweb=factory(bidi_helpers)}})(function(bidi_helpers){var module={};var IProcessor={makeRtl:function(element){},makeLtr:function(element){}};var css_processor=function(classes){return{makeRtl:function(element){element.classList.add(classes.rtl)},makeLtr:function(element){element.classList.add(classes.ltr)}}};var style_processor=function(falign){return{makeRtl:function(element){element.style.direction="rtl";if(falign){element.style.textAlign="right"}},makeLtr:function(element){element.style.direction="ltr";if(falign){element.style.textAlign="left"}}}};module.processors={css:css_processor,style:style_processor};var nodeListMock=function(node){var list=[node];list.item=function(i){return list[i]};return list};module.process=function(query,processor){var elements;if(query instanceof NodeList){elements=query}else{if(query instanceof Node){elements=nodeListMock(query)}else{elements=document.querySelectorAll(query)}}module.process_elements(elements,processor);return elements};module.process_elements=function(elements,processor){for(var index=0;index<elements.length;index++){var element=elements.item(index);var text=element.textContent||element.value||element.placeholder||"";var dir=bidi_helpers.estimateDirection(text,0.4);if(dir==bidi_helpers.Dir.RTL){processor.makeRtl(element)}else{if(dir==bidi_helpers.Dir.LTR){processor.makeLtr(element)}}}};module.process_css=function(query,classes){var proc=module.processors.css(classes);return module.process(query,proc)};module.process_style=function(query,falign){var proc=module.processors.style(falign);return module.process(query,proc)};module.style=function(query){return module.process_style(query,true)};module.css=function(query){return module.process_css(query,{rtl:"rtl",ltr:"ltr"})};module.htmlToElement=function(html){var container=document.createElement("div");container.innerHTML=html;return container};module.html_css=function(html){var container=module.htmlToElement(html);var nodes=container.querySelectorAll("*");module.css(nodes);return container.innerHTML};module.html_style=function(html){var container=module.htmlToElement(html);var nodes=container.querySelectorAll("*");module.style(nodes);return container.innerHTML};return module});</script>

</body>
</html>